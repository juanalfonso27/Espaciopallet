<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión - 7 Unidades</title>
    <link rel="manifest" href="/manifest.json">

    <style>
/* Reset global */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* Altura completa en html y body */
html, body {
  height: 100%;
}

/* Fondo y centrado general */
body {
  font-family: Arial, sans-serif;
   background-color:#F0F1FE;
  
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
  color: #fff;
}

/* Título de la página */
h1 {
    color: black;
  font-size: 2rem;
  text-align: center;
  margin-bottom: 20px;
  line-height: 1.2;
}

/* Formulario: fondo blanco semi-transparente con bordes redondeados y sombra */
form {
  background-color:  #001f3f; /* Tonos azules profundos */
  padding: 30px;
  width: 100%;
  max-width: 400px;
  border-radius: 12px;
  
  display: flex;
  flex-direction: column;
}

/* Imágenes dentro del formulario: centradas, con sutil sombra para realzar los logos */
#logo1 {
    background-color:  #001f3f;  /* Tonos azules profundos */
  display: block;
  margin: 0 auto 20px;
  max-width: 80%;
  border-radius: 8px;

}
#logo2 {
   padding: 2%;
   align-self: center;
    width: 130%;
}

/* Inputs: ocupan todo el ancho con detalles sutiles */
input {
    
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

/* Botón: tono teal armónico que contrasta y armoniza con el fondo azul */
button {
  width: 100%;
  padding: 12px;
  background-color: #20c997;  /* Teal fresco */
  border: none;
  border-radius: 8px;
  color: #fff;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #1aa179;
}

/* Media Query para pantallas pequeñas */
@media (max-width: 480px) {
  h1 {
    font-size: 1.5rem;
    margin-bottom: 15px;
  }

  form {
    padding: 20px;
  }
  
  input, button {
    font-size: 14px;
    padding: 10px;
  }
}
    </style>
</head>
<body>
    <h1>Inicie sesión</h1>
    <form id="loginForm">
        <!-- Logo principal -->
        <img id="logo1" src="logo1.png" alt="Logo de la página">
        
        <!-- Campos de entrada -->
        <input type="text" id="username" placeholder="Nombre de usuario" required>
        <input type="password" id="password" placeholder="Contraseña" required>
        
        <!-- Botones -->
        <button type="button" onclick="login()" class="btn-login">Iniciar Sesión</button>
        
        <!-- Logo secundario -->
        <img id="logo2" src="logo2.png" alt="Marcas">
    </form>

<script type="module">
// Importar módulos necesarios desde Firebase
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-analytics.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-database.js";

// Configuración de Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCODzFUSe34wHq8-m5taiFjKyEKfg5uZuU",
  authDomain: "espaciodeposito.firebaseapp.com",
  projectId: "espaciodeposito",
  storageBucket: "espaciodeposito.firebasestorage.app",
  messagingSenderId: "747647868200",
  appId: "1:747647868200:web:6bcba84a0b48dda9be841d",
  measurementId: "G-BBJLFHPW6J"
};

// Inicializar Firebase, Analytics y Realtime Database
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const dbRT = getDatabase(app);

// Función para registrar usuario
function createAccount() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  
  if (!username || !password) {
    alert('Por favor, ingresa un nombre de usuario y contraseña.');
    return;
  }
  
  // Crear una referencia para el usuario usando el username
  const userRef = ref(dbRT, "usuarios/" + username);
  
  // Verificar si el usuario ya existe
  get(userRef)
    .then((snapshot) => {
      if (snapshot.exists()) {
        alert("El nombre de usuario ya existe. Por favor, elige otro.");
      } else {
        // Guarda el usuario en la base de datos
        set(userRef, {
          username: username,
          password: password
        })
        .then(() => {
          alert('Cuenta creada exitosamente. Ahora puedes iniciar sesión.');
          // Limpiar los campos después del registro exitoso
          document.getElementById('username').value = '';
          document.getElementById('password').value = '';
        })
        .catch((error) => {
          console.error("Error al registrar usuario:", error);
          alert("Error al registrar usuario.");
        });
      }
    })
    .catch((error) => {
      console.error("Error verificando usuario:", error);
      alert("Hubo un error, inténtalo de nuevo.");
    });
}

// Función para iniciar sesión
function login() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  
  if (!username || !password) {
    alert('Por favor, ingresa tu nombre de usuario y contraseña.');
    return;
  }
  
  const userRef = ref(dbRT, "usuarios/" + username);
  
  get(userRef)
    .then((snapshot) => {
      if (snapshot.exists()) {
        const userData = snapshot.val();
        if (userData.password === password) {
          // Redireccionar según el nombre de usuario:
          // Si es pablo, fatima, jeanne o sussan, redirige a "para ver el espacio.html".
          // Caso contrario, a "paracambiarlosdatos.html".
          const lowerUsername = username.toLowerCase();
          if (["pablo", "fatima", "jeanne", "sussan"].includes(lowerUsername)) {
            window.location.href = "para ver el espacio.html";
          } else {
            window.location.href = "paracambiarlosdatos.html";
          }
        } else {
          alert("Contraseña incorrecta");
        }
      } else {
        alert("Usuario no encontrado");
      }
    })
    .catch((error) => {
      console.error("Error en el login:", error);
      alert("Error al iniciar sesión.");
    });
}

// Exponer las funciones globalmente para ser accesibles desde el HTML
window.createAccount = createAccount;
window.login = login;

// Service Worker
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then((registration) => {
        console.log('Service Worker registrado con éxito en:', registration.scope);
      })
      .catch((error) => {
        console.error('Error al registrar el Service Worker:', error);
      });
  });
}

// Opcional: permitir login con Enter
document.getElementById('password').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    login();
  }
});

document.getElementById('username').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    login();
  }
});
</script>

</body>
</html>
